var glacier={};!function(r){var e;Object.defineProperties(r,{VERSION:{value:"0.0.4",writable:!1},language:{get:function(){return e},set:function(t){if(r.i18n[t])e=t;else{var a=r.i18n.alias[t]?r.i18n.alias[t][0]:null;e=r.i18n[a]?a:"en",r.warn("UNDEFINED_LANGUAGE",{language:t,fallback:e})}}}}),r.load=function(r,e){var t,a="function"==typeof e?!0:!1;try{t=new XMLHttpRequest}catch(i){return!1}a&&(t.onreadystatechange=function(){4!=t.readyState||200!=t.status&&0!==t.status||e(t.responseText)});try{t.open("GET",r,a),t.overrideMimeType("text/plain"),t.send()}catch(i){return!1}return a?!0:t.responseText},r.log=function(e,t,a){var i,n=r.i18n(e);if(n||("warning"==t?(n=r.i18n("UNDEFINED_WARNING"),a={warning:e}):"error"==t&&(n=r.i18n("UNDEFINED_ERROR"),a={error:e})),"object"==typeof a&&(i=n.match(/\{[^\}]*\}/g)))for(var s in i){var o=i[s].substr(1,i[s].length-2);a.hasOwnProperty(o)&&(n=n.replace(i[s],a[o]))}switch(t){case"error":console.error(n);break;case"warning":console.warn(n);break;default:console.log(e)}},r.error=function(e,t){r.log(e,"error",t)},r.warn=function(e,t){r.log(e,"warning",t)},r.isArray=function(r,e){var t;return[Array,Int8Array,Int16Array,Int32Array,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,Float32Array,Float64Array].forEach(function(e){!t&&r instanceof e&&(t=!0)}),!!t},r.extend=function(r,e,t){var a,i,n,s,o=arguments,h=[];for(a=1;a<o.length;++a)if(o[a]instanceof Object)if(s=h.push(function(){})-1){if(h[s].prototype=Object.create(h[s-1].prototype),n=o[a].prototype)for(i in n)n.hasOwnProperty(i)&&(h[s].prototype[i]=n[i]);else if(n=o[a])for(i in n)n.hasOwnProperty(i)&&(h[s].prototype[i]=n[i])}else h[s].prototype=Object.create(o[a].prototype||o[a]);n=r.prototype,r.prototype=Object.create(h.pop().prototype);for(a in n)n.hasOwnProperty(a)&&(r.prototype[a]=n[a]);return r},r.union=function(e,t){function a(a){Object.defineProperty(this,e[a],{get:function(){return t},set:function(i){typeof i==typeof t?t=i:r.error("INVALID_ASSIGNMENT",{variable:e[a],value:typeof i,expected:typeof t})}})}e=e instanceof Array?e:[e];for(var i in e)a.call(this,i)},"object"==typeof module&&(module.exports=r)}(glacier),glacier.Camera=function(r,e){var t,a=["verticalViewAngle","aspectRatio"];Object.defineProperties(this,{aspectRatio:{get:function(){return e},set:function(r){"number"==typeof r&&r>0?(e=r,update()):glacier.error("INVALID_ASSIGNMENT",{variable:"Camera.aspectRatio",value:r,expected:"positive number"})}},fieldOfView:{get:function(){return r},set:function(e){"number"==typeof e&&e>0?(r=e,update()):glacier.error("INVALID_ASSIGNMENT",{variable:"camera.fieldOfView",value:e,expected:"positive number"})}},matrix:{value:new glacier.Matrix44,writable:!1},position:{value:new glacier.Vector3(0,1,1),writable:!1},target:{value:new glacier.Vector3(0,0,0),writable:!1}}),[r,e].forEach(function(r,e){("number"!=typeof r||0>=r)&&(glacier.error("INVALID_PARAMETER",{parameter:a[e],value:typeof r,expected:"positive number",method:"Camera constructor"}),t=!0)}),t&&(r="number"==typeof r&&r>0?r:60,e="number"==typeof e&&e>0?e:16/9),this.update()},glacier.Camera.prototype={follow:function(r,e,t){if(!(r instanceof glacier.Vector3))return void glacier.error("INVALID_PARAMETER",{parameter:"target",value:typeof r,expected:"Vector3",method:"Camera.follow"});if(!(e instanceof glacier.Vector2))return void glacier.error("INVALID_PARAMETER",{parameter:"angle",value:typeof e,expected:"Vector2",method:"Camera.follow"});if("number"!=typeof t||0>=t)return void glacier.error("INVALID_PARAMETER",{parameter:"distance",value:typeof t,expected:"positive number",method:"Camera.follow"});var a={},i={},n=new glacier.Vector2(glacier.limitAngle(e.x),glacier.limitAngle(e.y));a.hyp=t,a.opp=a.hyp*Math.sin(glacier.degToRad(n.y)),a.adj=a.hyp*Math.cos(glacier.degToRad(n.y)),i.hyp=a.adj,i.opp=i.hyp*Math.sin(glacier.degToRad(n.x)),i.adj=i.hyp*Math.cos(glacier.degToRad(n.x)),this.target=r,this.position.x=r.x-i.opp,this.position.y=r.y+a.opp,this.position.z=r.z-i.adj,this.update()},update:function(){var r,e,t=new glacier.Vector3(0,1,0);(r=new glacier.Vector3(this.position).subtract(this.target)).length()&&r.normalize(),(e=t.crossProduct(r)).length()&&e.normalize(),(t=r.crossProduct(e)).length()&&t.normalize(),this.matrix.assign(new glacier.Matrix44),this.matrix.perspective(this.fieldOfView,this.aspectRatio,.1,100),this.matrix.assign(new glacier.Matrix44([e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1]).multiply(this.matrix)).translate(-this.position.x,-this.position.y,-this.position.z)}},glacier.Color=function(r){var e,t,a,i=255;if(Object.defineProperties(this,{r:{get:function(){return i>>24&255},set:function(r){"number"==typeof r&&r>=0&&255>=r?i=((255&r)<<24)+(16777215&i)>>>0:glacier.error("INVALID_ASSIGNMENT",{variable:"Color.r",value:r,expected:"number between 0 and 255"})}},g:{get:function(){return i>>16&255},set:function(r){"number"==typeof r&&r>=0&&255>=r?i=((255&r)<<16)+(4278255615&i)>>>0:glacier.error("INVALID_ASSIGNMENT",{variable:"Color.g",value:r,expected:"number between 0 and 255"})}},b:{get:function(){return i>>8&255},set:function(r){"number"==typeof r&&r>=0&&255>=r?i=((255&r)<<8)+(4294902015&i)>>>0:glacier.error("INVALID_ASSIGNMENT",{variable:"Color.b",value:r,expected:"number between 0 and 255"})}},a:{get:function(){return(i>>0&255)/255},set:function(r){"number"==typeof r&&r>=0&&1>=r?i=((255*r&255)<<0)+(4294967040&i)>>>0:glacier.error("INVALID_ASSIGNMENT",{variable:"Color.a",value:r,expected:"number between 0.0 and 1.0"})}},rgb:{get:function(){return i>>8&16777215},set:function(r){if("number"==typeof r&&r>=0&&16777215>=r)i=((16777215&r)<<8)+(255&i)>>>0;else if(glacier.isArray(r)){for(e=0,a=[];e<r.length&&("number"==typeof r[e]&&r[e]>=0&&r[e]<=1);++e)a.push(r[e]);3==a.length?this.rgb=(255*a[0]<<16)+(255*a[1]<<8)+255*a[2]>>>0:glacier.error("INVALID_ASSIGNMENT",{variable:"Color.rgb",value:"["+r.join(", ")+"]",expected:"array[3] of numbers between 0.0 and 1.0"})}else r="number"==typeof r?"0x"+r.toString(16).toUpperCase():r,glacier.error("INVALID_ASSIGNMENT",{variable:"Color.rgb",value:r,expected:"RGB as 24-bits integer or array[3] of numbers between 0.0 and 1.0"})}},rgba:{get:function(){return i},set:function(r){if("number"==typeof r&&r>=0&&4294967295>=r)i=(4294967295&r)>>>0;else if(glacier.isArray(r)){for(e=0,a=[];e<r.length&&("number"==typeof r[e]&&r[e]>=0&&r[e]<=1);++e)a.push(r[e]);4==a.length?this.rgba=(255*a[0]<<24)+(255*a[1]<<16)+(255*a[2]<<8)+255*a[3]>>>0:glacier.error("INVALID_ASSIGNMENT",{variable:"Color.rgba",value:"["+r.join(", ")+"]",expected:"array[4] of numbers between 0.0 and 1.0"})}else r="number"==typeof r?"0x"+r.toString(16).toUpperCase():r,glacier.error("INVALID_ASSIGNMENT",{variable:"Color.rgba",value:r,expected:"RGBA as 32-bits integer or array[4] of numbers between 0.0 and 1.0"})}}}),r instanceof glacier.Color)this.rgba=r.rgba;else if(glacier.isArray(r))this.rgba=r;else switch((t=arguments).length){case 1:this.rgb=t[0];break;case 2:this.rgb=t[0],this.a=t[1];break;case 3:case 4:for(e=0,a=[];e<t.length;++e){if("number"!=typeof t[e])return void glacier.error("INVALID_PARAMETER",{parameter:t[e],expected:"number",method:"Color constructor"});a.push(t[e]/(3>e?255:1))}for(;a.length<4;)a.push(1);this.rgba=a}},glacier.Color.prototype={toArray:function(){return new Float32Array([this.r/255,this.g/255,this.b/255,this.a])},toString:function(){return"rgba("+[this.r,this.g,this.b,this.a.toFixed(2)].join(", ")+")"}},glacier.color={},Object.defineProperties(glacier.color,{WHITE:{get:function(){return new glacier.Color(16777215,1)}},SILVER:{get:function(){return new glacier.Color(12632256,1)}},GRAY:{get:function(){return new glacier.Color(8421504,1)}},BLACK:{get:function(){return new glacier.Color(0,1)}},RED:{get:function(){return new glacier.Color(16711680,1)}},MAROON:{get:function(){return new glacier.Color(8388608,1)}},YELLOW:{get:function(){return new glacier.Color(16776960,1)}},OLIVE:{get:function(){return new glacier.Color(8421376,1)}},LIME:{get:function(){return new glacier.Color(65280,1)}},GREEN:{get:function(){return new glacier.Color(32768,1)}},AQUA:{get:function(){return new glacier.Color(65535,1)}},TEAL:{get:function(){return new glacier.Color(32896,1)}},BLUE:{get:function(){return new glacier.Color(255,1)}},NAVY:{get:function(){return new glacier.Color(128,1)}},FUCHSIA:{get:function(){return new glacier.Color(16711935,1)}},PURPLE:{get:function(){return new glacier.Color(8388736,1)}}}),glacier.context={},glacier.Context=function(r,e){var t,a=[];if("string"==typeof r)for(t in glacier.context)if(glacier.context.hasOwnProperty(t)){if(t.toLowerCase()==r.toLowerCase())return"string"==typeof e&&(e={container:e}),ctor=new glacier.context[t](e),Object.defineProperty(ctor,"type",{value:t,writable:!1}),ctor;a.push(t)}a=a.join(", ");var i=a.lastIndexOf(", ");return a=i>=0?a.substr(0,i)+" or"+a.substr(i+1):a,glacier.error("INVALID_PARAMETER",{parameter:"type",value:r,expected:a,method:"Context constructor"}),null},glacier.Context.prototype={clear:function(){glacier.warn("MISSING_IMPLEMENTATION",{implementation:"clear",child:this.type,parent:"Context"})},resize:function(){glacier.warn("MISSING_IMPLEMENTATION",{implementation:"resize",child:this.type,parent:"Context"})}},glacier.Mesh=function(r){},glacier.Mesh.prototype={generateSphere:function(r,e,t){var a=new glacier.Sphere(r,e,t);return a.radius?(this.indices=a.indices,this.normals=a.normals,this.uvCoords=a.uvCoords,this.vertices=a.vertices,!0):!1}},"indices,normals,uvCoords,vertices".split(",").forEach(function(r,e){var t,a=[];Object.defineProperty(glacier.Mesh.prototype,r,{get:function(){return a},set:function(e){if(glacier.isArray(e))for(t=0;t<e.length;++t)a.push(e[t]);else glacier.error("INVALID_ASSIGNMENT",{variable:"Mesh."+r,value:typeof e,expected:"array"})}})}),glacier.i18n=function(r,e){if(e=e||glacier.language,glacier.i18n[e]&&glacier.i18n[e][r])return glacier.i18n[e][r];if(glacier.i18n.alias[e])for(var t in glacier.i18n.alias[e]){var a=glacier.i18n.alias[e][t];if(glacier.i18n[a]&&glacier.i18n[a][r])return glacier.i18n[a][r]}return glacier.i18n.en[r]||null},glacier.i18n.alias={no:["nb","nn"],nb:["nn"],nn:["nb"]},glacier.EPSILON=1e-4,glacier.compare=function(r,e){var t,a=glacier.isArray(r),i=glacier.isArray(e);if(!a||!i){if(a||i){var n=a?r:e,s=a?e:r;for(t=0;t<n.length;++t)if("number"==typeof n[t]&&"number"==typeof s){if(Math.abs(n[t]-s)>=glacier.EPSILON)return!1}else if(n[t]!==s)return!1;return!0}return"number"==typeof r&&"number"==typeof e?Math.abs(r-e)<glacier.EPSILON:r===e}if(r.length==e.length){for(t=0;t<r.length;++t)if("number"==typeof r[t]&&"number"==typeof e[t]){if(Math.abs(r[t]-e[t])>=glacier.EPSILON)return!1}else if(r!==e)return!1;return!0}return!1},glacier.degToRad=function(r){return"number"==typeof r?r*Math.PI/180:(glacier.error("INVALID_PARAMETER",{parameter:"degrees",value:typeof r,expected:"number",method:"degToRad"}),r)},glacier.radToDeg=function(r){return"number"==typeof r?180*r/Math.PI:(glacier.error("INVALID_PARAMETER",{parameter:"radians",value:typeof r,expected:"number",method:"radToDeg"}),r)},glacier.limitAngle=function(r,e,t){if("number"!=typeof r)return glacier.error("INVALID_PARAMETER",{parameter:"angle",value:typeof r,expected:"number",method:"limitAngle"}),null;if("number"!=typeof(e=void 0===e?360:e))return glacier.error("INVALID_PARAMETER",{parameter:"max",value:typeof e,expected:"number",method:"limitAngle"}),null;if("number"!=typeof(t=void 0===t?0:t))return glacier.error("INVALID_PARAMETER",{parameter:"min",value:typeof t,expected:"number",method:"limitAngle"}),null;for(t>e&&(e=t+(t=e,0));r>e;)r-=e;for(;t>r;)r+=e;return r},glacier.clamp=function(r,e,t){var a,i=["value","min","max"];return[r,e,t].forEach(function(r,e){"number"!=typeof r&&(glacier.error("INVALID_PARAMETER",{parameter:i[e],value:typeof r,expected:"number",method:"clamp"}),a=!0)}),a?null:(e>t&&(t=e+(e=t,0)),Math.max(e,Math.min(t,r)))},glacier.context.WebGL=function(r){r="object"==typeof r?r:{};var e,t,a,i;r.container instanceof HTMLElement?a=r.container:"string"==typeof r.container?(a=document.getElementById(r.container))||glacier.error("UNDEFINED_ELEMENT",{element:r.container,method:"context.WebGL constructor"}):glacier.error("MISSING_PARAMETER",{parameter:"container",method:"context.WebGL constructor"}),a instanceof HTMLCanvasElement?t=a:a instanceof HTMLElement&&(t=document.createElement("CANVAS"),t.style.position="relative;",t.style.width="100%",t.style.height="100%",a.appendChild(t)),t instanceof HTMLCanvasElement&&(Object.defineProperty(this,"canvas",{value:t,writable:!1}),Object.defineProperties(this,{canvas:{value:t,writable:!1},width:{get:function(){return this.canvas.width},set:function(r){"number"==typeof r&&r>0?this.resize(r,height):glacier.error("INVALID_ASSIGNMENT",{variable:"Context.width",value:r,expected:"positive number"})}},height:{get:function(){return this.canvas.height},set:function(r){"number"==typeof r&&r>0?this.resize(width,r):glacier.error("INVALID_ASSIGNMENT",{variable:"Context.height",value:r,expected:"positive number"})}}}),this.canvas.width=t.offsetWidth,this.canvas.height=t.offsetHeight,window.addEventListener("resize",function(r){(t.width!=t.offsetWidth||t.height!=t.offsetHeight)&&this.resize(t.offsetWidth,t.offsetHeight)}.bind(this)),(i=this.canvas.getContext("webgl"))&&Object.defineProperty(this,"gl",{value:i,writable:!1}),this.gl&&(Object.defineProperty(this,"background",{get:function(){return e},set:function(r){r instanceof glacier.Color?(e=r,this.gl.clearColor(r.r/255,r.g/255,r.b/255,r.a),this.gl.clear(this.gl.COLOR_BUFFER_BIT)):glacier.error("INVALID_ASSIGNMENT",{variable:"Context.background",value:typeof r,expected:"Color"})}}),this.background=glacier.color.BLACK),this.clear())},glacier.extend(glacier.context.WebGL,glacier.Context,{clear:function(){this.gl&&this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)},resize:function(r,e){return"number"!=typeof r||0>=r?void glacier.error("INVALID_PARAMETER",{parameter:"width",value:typeof r,expected:"positive number",method:"Context.resize"}):"number"!=typeof e||0>=e?void glacier.error("INVALID_PARAMETER",{parameter:"height",value:typeof e,expected:"positive number",method:"Context.resize"}):(this.canvas&&(this.canvas.width=r,this.canvas.height=e),void(this.gl&&this.gl.viewport(0,0,r,e)))},createProgram:function(r,e){if(!this.gl)return glacier.error("CONTEXT_ERROR",{context:"WebGL",error:"uninitialized context"}),null;if(!(r instanceof WebGLShader))return glacier.error("INVALID_PARAMETER",{parameter:"vertShader",value:typeof r,expected:"WebGLShader",method:"context.WebGL.createProgram"}),null;if(!(e instanceof WebGLShader))return glacier.error("INVALID_PARAMETER",{parameter:"fragShader",value:typeof e,expected:"WebGLShader",method:"context.WebGL.createProgram"}),null;var t=this.gl.createProgram();return this.gl.attachShader(t,r),this.gl.attachShader(t,e),this.gl.linkProgram(t),this.gl.getProgramParameter(t,this.gl.LINK_STATUS)?t:(glacier.error("CONTEXT_ERROR",{context:"WebGL",error:this.gl.getProgramInfoLog(t)}),null)},createShader:function(r,e){if(!this.gl)return glacier.error("CONTEXT_ERROR",{context:"WebGL",error:"uninitialized context"}),null;var t,a,i=[this.gl.FRAGMENT_SHADER,this.gl.VERTEX_SHADER];return"string"!=typeof e?(glacier.error("INVALID_PARAMETER",{parameter:"source",value:typeof e,expected:"string",method:"context.WebGL.createShader"}),null):-1==i.indexOf(r)?(t=(i=i.join(", ")).lastIndexOf(", "),i=t>=0?i.substr(0,t)+" or"+i.substr(t+1):i,glacier.error("INVALID_PARAMETER",{parameter:"type",value:r,expected:i,method:"context.WebGL.createShader"}),null):(a=this.gl.createShader(r),this.gl.shaderSource(a,e),this.gl.compileShader(a),this.gl.getShaderParameter(a,this.gl.COMPILE_STATUS)?a:(glacier.error("CONTEXT_ERROR",{context:"WebGL",error:this.gl.getShaderInfoLog(a)}),null))}}),glacier.Sphere=function(r,e,t){t="number"==typeof t&&t>=0?t:0,Object.defineProperties(this,{indices:{value:[],writable:!1},normals:{value:[],writable:!1},radius:{get:function(){return t},set:function(r){"number"==typeof r&&r>=0?(r>0&&this.vertices.forEach(function(e){e=e/t*r}),this.indices.length&&this.destroy(),t=r):glacier.error("INVALID_ASSIGNMENT",{variable:"Sphere.radius",value:r,expected:"positive number"})}},uvCoords:{value:[],writable:!1},vertices:{value:[],writable:!1}}),r&&e&&this.generate(r,e,t||1)},glacier.Sphere.prototype={destroy:function(){this.indices.length=0,this.normals.length=0,this.uvCoords.length=0,this.vertices.length=0,this.radius=0},generate:function(r,e,t){if("number"!=typeof r||3>r)return glacier.error("INVALID_PARAMETER",{parameter:"latitudes",value:r,expected:"number (>= 3)",method:"Sphere.generate"}),!1;if(r=Math.round(Math.abs(r)),"number"!=typeof e||3>e)return glacier.error("INVALID_PARAMETER",{parameter:"longitudes",value:e,expected:"number (>= 3)",method:"Sphere.generate"}),!1;if(e=Math.round(Math.abs(e)),void 0===t)t=1;else if("number"!=typeof t||0>=t)return glacier.error("INVALID_PARAMETER",{parameter:"radius",value:t,expected:"number (> 0.0)",method:"Sphere.generate"}),!1;this.destroy(),this.radius=t;var a,i,n,s,o,h,c,l,y,u,f,g,p;for(a=0;r>=a;++a)for(n=a*Math.PI/r,s=Math.sin(n),o=Math.cos(n),i=0;e>=i;++i)h=2*i*Math.PI/e,c=Math.sin(h),l=Math.cos(h),y=l*s,u=o,f=c*s,g=1-i/e,p=a/r,this.vertices.push(t*y,t*u,t*f),this.normals.push(y,u,f),this.uvCoords.push(g,p);for(a=0;r>a;++a)for(i=0;e>i;++i)y=a*(e+1)+i,u=y+e+1,this.indices.push(y,u,y+1),this.indices.push(u,u+1,y+1);return!0}},glacier.Matrix33=function(r){Object.defineProperty(this,"array",{value:new Float32Array([1,0,0,0,1,0,0,0,1]),writable:!1}),r&&this.assign(r)},glacier.Matrix33.prototype={assign:function(r){var e,t,a;if(r instanceof glacier.Matrix33)for(a in r.array)this.array[a]=r.array[a];else if(r instanceof glacier.Matrix44)for(t=0;3>t;++t)for(e=0;3>e;++e)this.array[3*t+e]=r.array[4*t+e];else if(glacier.isArray(r)&&9==r.length)for(a=0;a<r.length;++a)this.array[a]=r[a];else if("number"==typeof r)for(a in this.array)this.array[a]=r;else glacier.error("INVALID_PARAMETER",{parameter:"value",value:typeof r,expected:"number, Matrix33, Matrix44 or array[9]",method:"Matrix33.assign"});return this},determinant:function(){return this.array[0]*(this.array[4]*this.array[8]-this.array[5]*this.array[7])-this.array[1]*(this.array[3]*this.array[8]-this.array[5]*this.array[6])+this.array[2]*(this.array[3]*this.array[7]-this.array[4]*this.array[6])},element:function(r,e){if("number"==typeof e&&"number"==typeof r){if(e>=0&&3>=e&&r>=0&&3>=r)return this.array[3*r+e]}else if("number"==typeof r)return this.array[r];return void glacier.error("INDEX_OUT_OF_RANGE",{index:r+(e||0),range:"0-9",method:"Matrix33.element"})},multiply:function(r){var e,t,a,i;if(r instanceof glacier.Matrix33)for(i=new Float32Array(this.array),e=0;3>e;++e)for(t=0;3>t;++t)this.array[3*e+t]=i[3*e+0]*r.array[0+t]+i[3*e+1]*r.array[3+t]+i[3*e+2]*r.array[6+t];else if(r instanceof glacier.Matrix44)this.multiply(new glacier.Matrix33(r));else if("number"==typeof r)for(a in this.array)this.array[a]*=r;else glacier.error("INVALID_PARAMETER",{parameter:"value",value:typeof r,expected:"number, Matrix33 or Matrix44",method:"Matrix33.multiply"});return this},transpose:function(){var r;return r=this.array[1],this.array[1]=this.array[3],this.array[3]=r,r=this.array[2],this.array[2]=this.array[6],this.array[6]=r,r=this.array[5],this.array[5]=this.array[7],this.array[7]=r,this},transposed:function(){var r=new glacier.Matrix33(this);return r.transpose()},inverse:function(){var r=new glacier.Matrix33(this);return r.invert()?r:void glacier.error("MATRIX_NO_INVERSE",{matrix:r.toString(),method:"Matrix33.inverse"})},invert:function(){var r=new Float32Array([this.array[4]*this.array[8]-this.array[5]*this.array[7],this.array[2]*this.array[7]-this.array[1]*this.array[8],this.array[1]*this.array[5]-this.array[2]*this.array[4],this.array[5]*this.array[6]-this.array[3]*this.array[8],this.array[0]*this.array[8]-this.array[2]*this.array[6],this.array[2]*this.array[3]-this.array[0]*this.array[5],this.array[3]*this.array[7]-this.array[4]*this.array[6],this.array[1]*this.array[6]-this.array[0]*this.array[7],this.array[0]*this.array[4]-this.array[1]*this.array[3]]),e=this.array[0]*r[0]+this.array[1]*r[3]+this.array[2]*r[6];if(glacier.compare(e,0))return!1;e=1/e;for(var t=0;t<r.length;++t)this.array[t]=r[t]*e;return!0},toString:function(){return"[["+this.array[0].toPrecision(5)+", "+this.array[1].toPrecision(5)+", "+this.array[2].toPrecision(5)+"], ["+this.array[3].toPrecision(5)+", "+this.array[4].toPrecision(5)+", "+this.array[5].toPrecision(5)+"], ["+this.array[6].toPrecision(5)+", "+this.array[7].toPrecision(5)+", "+this.array[8].toPrecision(5)+"]]"}},glacier.Matrix44=function(r){Object.defineProperty(this,"array",{value:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),writable:!1}),r&&this.assign(r)},glacier.Matrix44.prototype={assign:function(r){var e,t,a;if(r instanceof glacier.Matrix33){for(t=0;3>t;++t)for(e=0;3>e;++e)this.array[4*t+e]=r.array[3*t+e];this.array[3]=this.array[7]=this.array[11]=0,this.array[12]=this.array[13]=this.array[14]=0,this.array[16]=1}else if(r instanceof glacier.Matrix44)for(a in r.array)this.array[a]=r.array[a];else if(glacier.isArray(r)&&16==r.length)for(a=0;a<r.length;++a)this.array[a]=r[a];else if("number"==typeof r)for(a in this.array)this.array[a]=r;else glacier.error("INVALID_PARAMETER",{parameter:"value",value:typeof r,expected:"number, Matrix33, Matrix44 or array[16]",method:"Matrix44.assign"});return this},determinant:function(){var r=this.array[0]*this.array[5]-this.array[1]*this.array[4],e=this.array[0]*this.array[6]-this.array[2]*this.array[4],t=this.array[0]*this.array[7]-this.array[3]*this.array[4],a=this.array[1]*this.array[6]-this.array[2]*this.array[5],i=this.array[1]*this.array[7]-this.array[3]*this.array[5],n=this.array[2]*this.array[7]-this.array[3]*this.array[6],s=this.array[8]*this.array[13]-this.array[9]*this.array[12],o=this.array[8]*this.array[14]-this.array[10]*this.array[12],h=this.array[8]*this.array[15]-this.array[11]*this.array[12],c=this.array[9]*this.array[14]-this.array[10]*this.array[13],l=this.array[9]*this.array[15]-this.array[11]*this.array[13],y=this.array[10]*this.array[15]-this.array[11]*this.array[14];return r*y-e*l+t*c+a*h-i*o+n*s},element:function(r,e){if("number"==typeof e&&"number"==typeof r){if(e>=0&&4>=e&&r>=0&&4>=r)return this.array[4*r+e]}else if("number"==typeof r)return this.array[r];return void glacier.error("INDEX_OUT_OF_RANGE",{index:r+(e||0),range:"0-16",method:"Matrix44.element"})},frustum:function(r,e,t,a,i,n){var s,o,h,c,l="left,right,bottom,top,near,far".split(",");return[r,e,t,a,i,n].forEach(function(r,e){"number"!=typeof r&&(glacier.error("INVALID_PARAMETER",{parameter:l[e],value:typeof r,expected:"number",method:"Matrix44.frustum"}),s=!0)}),s||0>=i||0>=n||(o=e-r)<=0||(h=a-t)<=0||(c=n-i)<=0?!1:(this.assign(new glacier.Matrix44([2*i/o,0,0,0,0,2*i/h,0,0,(e+r)/o,(a+t)/h,-(i+n)/c,-1,0,0,-2*i*n/c,0]).multiply(this)),!0)},inverse:function(){var r=new glacier.Matrix44(this);return r.invert()?r:void glacier.error("MATRIX_NO_INVERSE",{matrix:r.toString(),method:"Matrix44.inverse"})},invert:function(){var r=this.array[0]*this.array[5]-this.array[1]*this.array[4],e=this.array[0]*this.array[6]-this.array[2]*this.array[4],t=this.array[0]*this.array[7]-this.array[3]*this.array[4],a=this.array[1]*this.array[6]-this.array[2]*this.array[5],i=this.array[1]*this.array[7]-this.array[3]*this.array[5],n=this.array[2]*this.array[7]-this.array[3]*this.array[6],s=this.array[8]*this.array[13]-this.array[9]*this.array[12],o=this.array[8]*this.array[14]-this.array[10]*this.array[12],h=this.array[8]*this.array[15]-this.array[11]*this.array[12],c=this.array[9]*this.array[14]-this.array[10]*this.array[13],l=this.array[9]*this.array[15]-this.array[11]*this.array[13],y=this.array[10]*this.array[15]-this.array[11]*this.array[14],u=r*y-e*l+t*c+a*h-i*o+n*s;if(glacier.compare(u,0))return!1;var f=new Float32Array([this.array[5]*y-this.array[6]*l+this.array[7]*c,-this.array[1]*y+this.array[2]*l-this.array[3]*c,this.array[13]*n-this.array[14]*i+this.array[15]*a,-this.array[9]*n+this.array[10]*i-this.array[11]*a,-this.array[4]*y+this.array[6]*h-this.array[7]*o,this.array[0]*y-this.array[2]*h+this.array[3]*o,-this.array[12]*n+this.array[14]*t-this.array[15]*e,this.array[8]*n-this.array[10]*t+this.array[11]*e,this.array[4]*l-this.array[5]*h+this.array[7]*s,-this.array[0]*l+this.array[1]*h-this.array[3]*s,this.array[12]*i-this.array[13]*t+this.array[15]*r,-this.array[8]*i+this.array[9]*t-this.array[11]*r,-this.array[4]*c+this.array[5]*o-this.array[6]*s,this.array[0]*c-this.array[1]*o+this.array[2]*s,-this.array[12]*a+this.array[13]*e-this.array[14]*r,this.array[8]*a-this.array[9]*e+this.array[10]*r]);u=1/u;for(var g=0;g<f.length;++g)this.array[g]=f[g]*u;return!0},multiply:function(r){var e,t,a,i;if(r instanceof glacier.Matrix44)for(i=new Float32Array(this.array),e=0;4>e;++e)for(t=0;4>t;++t)this.array[4*e+t]=i[4*e+0]*r.array[0+t]+i[4*e+1]*r.array[4+t]+i[4*e+2]*r.array[8+t]+i[4*e+3]*r.array[12+t];else if(r instanceof glacier.Matrix33)this.multiply(new glacier.Matrix44(r));else if("number"==typeof r)for(a in this.array)this.array[a]*=r;else glacier.error("INVALID_PARAMETER",{parameter:"value",value:typeof r,expected:"number, Matrix33 or Matrix44",method:"Matrix44.multiply"});return this},ortho:function(r,e,t,a,i,n){var s,o="left,right,bottom,top,near,far".split(",");return[r,e,t,a,i,n].forEach(function(r,e){"number"!=typeof r&&(glacier.error("INVALID_PARAMETER",{parameter:o[e],value:typeof r,expected:"number",method:"Matrix44.ortho"}),s=!0)}),!s&&(dX=e-r)&&(dY=a-t)&&(dZ=n-i)?(this.assign(new glacier.Matrix44([2/dX,0,0,0,0,2/dY,0,0,0,0,-2/dZ,0,-(e+r)/dX,-(a+t)/dY,-(i+n)/dZ,1]).multiply(this)),!0):!1},perspective:function(r,e,t,a){var i,n,s,o="verticalViewAngle,aspectRatio,near,far".split(","),h=new glacier.Matrix44;return[r,e,t,a].forEach(function(r,e){"number"!=typeof r&&(glacier.error("INVALID_PARAMETER",{parameter:o[e],value:typeof r,expected:"number",method:"Matrix44.perspective"}),i=!0)}),i||0>=t||0>=a?!1:(n=Math.tan(r/360*Math.PI)*t,s=n*e,h.frustum(-s,s,-n,n,t,a)?(this.assign(h.multiply(this)),!0):!1)},rotate:function(r,e,t,a){if("number"!=typeof r)glacier.error("INVALID_PARAMETER",{parameter:"radians",value:typeof r,expected:"number",method:"Matrix44.rotate"});else{if(e instanceof glacier.Vector3)return this.rotate(r,e.x,e.y,e.z);var i,n,s,o,h,c=["x","y","z"],l=e;[l,t,a].forEach(function(r,e){"number"!=typeof r&&(glacier.error("INVALID_PARAMETER",{parameter:c[e],value:typeof r,expected:"number",method:"Matrix44.rotate"}),i=!0)}),i||(h=1-(n=Math.cos(r)),s=Math.sin(r),isNaN(o=Math.sqrt(l*l+t*t+a*a))||(l/=o,t/=o,a/=o,this.assign(new glacier.Matrix44([h*l*l+n,h*l*t-a*s,h*l*a+t*s,0,h*t*l+a*s,h*t*t+n,h*t*a-l*s,0,h*a*l-t*s,h*a*t+l*s,h*a*a+n,0,0,0,0,1]).multiply(this))))}return this},scale:function(r,e,t){if(r instanceof glacier.Vector3)return this.scale(r.x,r.y,r.z);var a,i=["x","y","z"],n=r;return[n,e,t].forEach(function(r,e){"number"!=typeof r&&(glacier.error("INVALID_PARAMETER",{parameter:i[e],value:typeof r,expected:"number",method:"Matrix44.scale"}),a=!0)}),a||(this.array[0]*=n,this.array[4]*=e,this.array[8]*=t,this.array[1]*=n,this.array[5]*=e,this.array[9]*=t,this.array[2]*=n,this.array[6]*=e,this.array[10]*=t,this.array[3]*=n,this.array[7]*=e,this.array[11]*=t),this},toString:function(){return"[["+this.array[0].toPrecision(5)+", "+this.array[1].toPrecision(5)+", "+this.array[2].toPrecision(5)+", "+this.array[3].toPrecision(5)+"], ["+this.array[4].toPrecision(5)+", "+this.array[5].toPrecision(5)+", "+this.array[6].toPrecision(5)+", "+this.array[7].toPrecision(5)+"], ["+this.array[8].toPrecision(5)+", "+this.array[9].toPrecision(5)+", "+this.array[10].toPrecision(5)+", "+this.array[11].toPrecision(5)+"], ["+this.array[12].toPrecision(5)+", "+this.array[13].toPrecision(5)+", "+this.array[14].toPrecision(5)+", "+this.array[15].toPrecision(5)+"]]"},translate:function(r,e,t){if(r instanceof glacier.Vector3)return this.translate(r.x,r.y,r.z);var a,i=["x","y","z"],n=r;return[n,e,t].forEach(function(r,e){"number"!=typeof r&&(glacier.error("INVALID_PARAMETER",{parameter:i[e],value:typeof r,expected:"number",method:"Matrix44.translate"}),a=!0)}),a||(this.array[12]+=this.array[0]*n+this.array[4]*e+this.array[8]*t,this.array[13]+=this.array[1]*n+this.array[5]*e+this.array[9]*t,this.array[14]+=this.array[2]*n+this.array[6]*e+this.array[10]*t,this.array[15]+=this.array[3]*n+this.array[7]*e+this.array[11]*t),this},transpose:function(){var r;return r=this.array[1],this.array[1]=this.array[4],this.array[4]=r,r=this.array[2],this.array[2]=this.array[8],this.array[8]=r,r=this.array[3],this.array[3]=this.array[12],this.array[12]=r,r=this.array[6],this.array[6]=this.array[9],this.array[9]=r,r=this.array[7],this.array[7]=this.array[13],this.array[13]=r,r=this.array[11],this.array[11]=this.array[14],this.array[14]=r,this},transposed:function(){var r=new glacier.Matrix44(this);return r.transpose()}},glacier.Vector2=function(r,e){glacier.union.call(this,["x","u"],"number"==typeof r?r:0),glacier.union.call(this,["y","v"],"number"==typeof e?e:0),Object.defineProperty(this,"array",{get:function(){return new Float32Array([this.x,this.y])},set:function(){}}),r instanceof glacier.Vector2&&this.assign(r)},glacier.Vector2.prototype={add:function(r){return r instanceof glacier.Vector2?(this.x+=r.x,this.y+=r.y):"number"==typeof r?(this.x+=r,this.y+=r):glacier.error("INVALID_PARAMETER",{parameter:"value",value:typeof r,expected:"number or Vector2",method:"Vector2.add"}),this},assign:function(r,e){if(r instanceof glacier.Vector2)return this.assign(r.x,r.y);var t,a=["x","y"],i=r;return[i,e].forEach(function(r,e){"number"!=typeof r&&(glaicer.error("INVALID_PARAMETER",{parameter:a[e],value:typeof r,expected:"number",method:"Vector2.assign"}),t=!0)}),t||(this.x=i,this.y=e),this},distance:function(r){var e=this.x-r.x,t=this.y-r.y;return Math.sqrt(e*e+t*t)},divide:function(r){return r instanceof glacier.Vector2?(this.x/=r.x,this.y/=r.y):"number"==typeof r?(this.x/=r,this.y/=r):glacier.error("INVALID_PARAMETER",{parameter:"value",value:typeof r,expected:"number or Vector2",method:"Vector2.divide"}),this},dotProduct:function(r){return this.x*r.x+this.y*r.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},multiply:function(r){return r instanceof glacier.Vector2?(this.x*=r.x,this.y*=r.y):"number"==typeof r?(this.x*=r,this.y*=r):glacier.error("INVALID_PARAMETER",{parameter:"value",value:typeof r,expected:"number or Vector2",method:"Vector2.multiply"}),this},normalize:function(){var r=1/this.length();return this.x*=r,this.y*=r,this},rotate:function(r){var e=Math.cos(r),t=Math.sin(r),a=this.x*e-this.y*t,i=this.x*t+this.y*e;return this.x=a,this.y=i,this},subtract:function(r){return r instanceof glacier.Vector2?(this.x-=r.x,this.y-=r.y):"number"==typeof r?(this.x-=r,this.y-=r):glacier.error("INVALID_PARAMETER",{parameter:"value",value:typeof r,expected:"number or Vector2",method:"Vector2.subtract"}),this},toString:function(){return"("+this.x+", "+this.y+")"}},glacier.Vector3=function(r,e,t){glacier.union.call(this,["x","u"],"number"==typeof r?r:0),glacier.union.call(this,["y","v"],"number"==typeof e?e:0),glacier.union.call(this,["z","w"],"number"==typeof t?t:0),Object.defineProperty(this,"array",{get:function(){return new Float32Array([this.x,this.y,this.z])},set:function(){}}),r instanceof glacier.Vector3&&this.assign(r)},glacier.Vector3.prototype={add:function(r){return r instanceof glacier.Vector3?(this.x+=r.x,this.y+=r.y,this.z+=r.z):"number"==typeof r?(this.x+=r,this.y+=r,this.z+=r):glacier.error("INVALID_PARAMETER",{parameter:"value",value:typeof r,expected:"number or Vector3",method:"Vector3.add"}),this},angle:function(r){var e=Math.acos(this.dotProduct(r)/(this.length()*r.length()));return isNaN(e)?0:e},assign:function(r,e,t){if(r instanceof glacier.Vector3)return this.assign(r.x,r.y,r.z);var a,i=["x","y","z"],n=r;return[n,e,t].forEach(function(r,e){"number"!=typeof r&&(glaicer.error("INVALID_PARAMETER",{
parameter:i[e],value:typeof r,expected:"number",method:"Vector3.assign"}),a=!0)}),a||(this.x=n,this.y=e,this.z=t),this},crossProduct:function(r){return new glacier.Vector3(this.y*r.z-this.z*r.y,this.z*r.x-this.x*r.z,this.x*r.y-this.y*r.x)},distance:function(r){var e=this.x-r.x,t=this.y-r.y,a=this.z-r.z;return Math.sqrt(e*e+t*t+a*a)},divide:function(r){return r instanceof glacier.Vector3?(this.x/=r.x,this.y/=r.y,this.z/=r.z):"number"==typeof r?(this.x/=r,this.y/=r,this.z/=r):r instanceof glacier.Matrix33?(this.x=this.x/r.element(0,0)+this.y/r.element(0,1)+this.z/r.element(0,2),this.y=this.x/r.element(1,0)+this.y/r.element(1,1)+this.z/r.element(1,2),this.z=this.x/r.element(2,0)+this.y/r.element(2,1)+this.z/r.element(2,2)):r instanceof glacier.Matrix44?(this.x=this.x/r.element(0,0)+this.y/r.element(0,1)+this.z/r.element(0,2)+r.element(0,3),this.y=this.x/r.element(1,0)+this.y/r.element(1,1)+this.z/r.element(1,2)+r.element(1,3),this.z=this.x/r.element(2,0)+this.y/r.element(2,1)+this.z/r.element(2,2)+r.element(2,3)):glacier.error("INVALID_PARAMETER",{parameter:"value",value:typeof r,expected:"number, Vector3, Matrix33 or Matrix44",method:"Vector3.divide"}),this},dotProduct:function(r){return this.x*r.x+this.y*r.y+this.z*r.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},multiply:function(r){return r instanceof glacier.Vector3?(this.x*=r.x,this.y*=r.y,this.z*=r.z):"number"==typeof r?(this.x*=r,this.y*=r,this.z*=r):r instanceof glacier.Matrix33?(this.x=this.x*r.element(0,0)+this.y*r.element(0,1)+this.z*r.element(0,2),this.y=this.x*r.element(1,0)+this.y*r.element(1,1)+this.z*r.element(1,2),this.z=this.x*r.element(2,0)+this.y*r.element(2,1)+this.z*r.element(2,2)):r instanceof glacier.Matrix44?(this.x=this.x*r.element(0,0)+this.y*r.element(0,1)+this.z*r.element(0,2)+r.element(0,3),this.y=this.x*r.element(1,0)+this.y*r.element(1,1)+this.z*r.element(1,2)+r.element(1,3),this.z=this.x*r.element(2,0)+this.y*r.element(2,1)+this.z*r.element(2,2)+r.element(2,3)):glacier.error("INVALID_PARAMETER",{parameter:"value",value:typeof r,expected:"number, Vector3, Matrix33 or Matrix44",method:"Vector3.multiply"}),this},normalize:function(){var r=1/this.length();return this.x*=r,this.y*=r,this.z*=r,this},rotateX:function(r){var e=Math.cos(r),t=Math.sin(r),a=this.y*e-this.z*t,i=this.y*t+this.z*e;return this.y=a,this.z=i,this},rotateY:function(r){var e=Math.cos(r),t=Math.sin(r),a=this.x*e-this.z*t,i=this.x*t+this.z*e;return this.x=a,this.z=i,this},rotateZ:function(r){var e=Math.cos(r),t=Math.sin(r),a=this.x*e-this.y*t,i=this.x*t+this.y*e;return this.x=a,this.y=i,this},subtract:function(r){return r instanceof glacier.Vector3?(this.x-=r.x,this.y-=r.y,this.z-=r.z):"number"==typeof r?(this.x-=r,this.y-=r,this.z-=r):glacier.error("INVALID_PARAMETER",{parameter:"value",value:typeof r,expected:"number or Vector3",method:"Vector3.subtract"}),this},toString:function(){return"("+this.x+", "+this.y+", "+this.z+")"}},glacier.i18n.en={CONTEXT_ERROR:"{context} context error: {error}",INDEX_OUT_OF_RANGE:"Index out of range: {index} (expected range {range}) in {method}",INVALID_ASSIGNMENT:"Invalid assigment of {variable}: {value} (expected {expected})",INVALID_PARAMETER:"Invalid parameter {parameter}: {value} (expected {expected}) in {method}",MATRIX_NO_INVERSE:"Inverse matrix does not exist: {matrix} in {method}",MISSING_IMPLEMENTATION:"Missing implementation: {implementation} in {child} extension of {parent}",MISSING_PARAMETER:"Missing mandatory parameter: {parameter} in {method}",UNDEFINED_ELEMENT:"Undefined element ID: {element} in {method}",UNDEFINED_ERROR:"Undefined error: {error}",UNDEFINED_WARNING:"Undefined warning: {warning}",UNDEFINED_LANGUAGE:"Undefined language: {language} (using {fallback} as fallback)",UNKNOWN_PROPERTY:"Unrecognized property: {property} in {object}"},glacier.i18n.nb={CONTEXT_ERROR:"{context} kontekstfeil: {error}",INDEX_OUT_OF_RANGE:"Index out of range: {index} (expected range {range}) in {method}",INVALID_ASSIGNMENT:"Ugyldig tildeing av {variable}: {value} (forventet {expected})",INVALID_PARAMETER:"Ugyldig parameter {parameter}: {value} (forventet {expected}) i {method}",MATRIX_NO_INVERSE:"Invers matrise eksisterer ikke: {matrix} i {method}",MISSING_IMPLEMENTATION:"Mangler implementasjon: {implementation} i {child} utvidelse av {parent}",MISSING_PARAMETER:"Mangler obligatorisk parameter: {parameter} i {method}",UNDEFINED_ELEMENT:"Udefinert element ID: {element} i {method}",UNDEFINED_ERROR:"Udefinert feilmelding: {error}",UNDEFINED_WARNING:"Udefinert advarsel: {warning}",UNDEFINED_LANGUAGE:"Udefinert språkkode: {language} (bruker {fallback})",UNKNOWN_PROPERTY:"Ukjent egenskap: {property} i {object}"};